let AWS = require("aws-sdk");

let endpointData = {
    "instances": [{
        "start": "2020-05-31 13:00:00",
        "target": [44.84509848222095, 45.444025426446636, 47.641204166682535, 44.85581268572061, 45.445314531665694, 50.12494448355544, 47.98852840953882, 49.87677400761961, 53.66417740720087, 51.415549790828095, 52.62151314188721, 51.78857928276875, 51.51450989886734, 52.70659345713841, 55.89453884086635, 51.915441366896715, 51.93300775846754, 50.91071924499365, 54.59268445108489, 52.0344482386366, 52.98441613518421, 49.505730833325885, 51.087750203643736, 48.458660782497674, 55.03420967031169, 51.85897596838499, 49.58676379024657, 49.89480531590981, 51.38793775547676, 48.20309463425001, 51.46576152981949, 52.977944045683586, 47.58067379238466, 51.8287553599165, 55.54419968472813, 55.47813007612471, 57.006109348541756, 54.81109445204887, 52.759179234979094, 55.3718241634044, 56.26744099665259, 54.66212638445647, 51.9189386220118, 49.97998429241412, 48.94014523913551, 51.393707519167286, 52.76261272372506, 55.292701064471515, 55.433491789666526, 51.411990437764295, 50.142804346689005, 49.68453611982053, 52.992276027870396, 51.61177103440893, 56.502423024956656, 52.47764078534571, 57.847651249313905, 50.35328519096806, 56.666869243696844, 60.23309249652759, 59.397115258016925, 60.34518070311136, 59.79871093893722, 58.21502380019783, 56.384517099378755, 58.88139784105108, 54.25737424216005, 54.529045505551444, 55.98684978180232, 55.935611359775116, 52.9099714586019, 51.80353649490985, 53.352601262186205, 53.234850964399435, 51.33003204949658, 53.05028106494528, 53.22041081244046, 59.609983526632256, 55.14185305156147, 58.65056315602457, 52.4451475072708, 57.569956318443225, 58.23749578391757, 57.219668310456605, 58.51105021657801, 59.77578665330887, 58.52263990570722, 59.574081953628216, 61.096019476242695, 58.57352218017452, 58.88412051392649, 54.64854443965835, 56.06756289752757, 58.03015012232101, 54.24518480115429, 56.01051671762803, 56.64411562386984, 52.23612007973209, 55.14683692588862, 53.09907329823606]
    }],
    "configuration": {
        "num_samples": 50,
        "output_types": ["mean", "quantiles", "samples"],
        "quantiles": ["0.1", "0.9"]
    }
};

const endpointName = "synth-endpoint";

let params = {
    EndpointName: endpointName,
    Body: JSON.stringify(endpointData),
    ContentType: "application/json",
    Accept: "application/json"
};

let awsRuntime = new AWS.SageMakerRuntime({});

exports.handler = event => {
    awsRuntime.invokeEndpoint(params, (err, data) => {
        if (err) {
            console.log(err, err.stack);

            const response = {
                statusCode: 500,
                body: JSON.stringify("Error: " + JSON.stringify(err))
            };

            return response;
        } else {
            let responseData = JSON.parse(Buffer.from(data.Body).toString('utf8'));
            console.log(JSON.stringify(responseData));

            const response = {
                statusCode: 200,
                body: JSON.stringify("Predictions returned")
            }

            return response;
        }
    })
}